# タスク管理ツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的
個人用のTrello風タスク管理ツールをSvelteKit + Cloudflare D1で構築する

### 1.2 技術スタック
- **フロントエンド**: SvelteKit
- **スタイリング**: Tailwind CSS
- **データベース**: Cloudflare D1 (SQLite)
- **ストレージ**: Cloudflare R2
- **デプロイ**: Cloudflare Pages
- **開発フロー**: ローカルでSQLite → 本番でD1移行

---

## 2. 機能要件

### 2.1 認証機能
- **ログイン画面**
  - ユーザー名とパスワードによる簡易認証
  - 認証情報はD1に保存
  - セッション管理（Cookie使用）
- **セキュリティレベル**: 個人利用のため最小限

### 2.2 ダッシュボード機能

#### 2.2.1 データ構造（3階層）
```
ボード
  └─ リスト
       └─ カード
```

#### 2.2.2 ボード管理
- ボードの作成・編集・削除
- 複数ボードの切り替え表示

#### 2.2.3 リスト管理
- リストの作成・編集・削除
- リストの並び替え（ドラッグ&ドロップ）
- ボード内での位置管理

#### 2.2.4 カード管理
- **カード基本情報**
  - タイトル（必須）
  - 内容・説明（任意）
  - 期限日付（任意）
- **カード操作**
  - カードの作成・編集・削除
  - リスト間の移動（ドラッグ&ドロップ）
  - リスト内での並び替え（ドラッグ&ドロップ）

#### 2.2.5 ラベル/タグ機能
- カードへの複数ラベル付与
- ラベルの作成・編集・削除
- ラベルによる視覚的な分類（色分け）

#### 2.2.6 ファイル添付機能
- カードへのファイル添付
- Cloudflare R2への保存
- ファイルのダウンロード・削除

---

## 3. 画面構成

### 3.1 ログイン画面
- ユーザー名入力フィールド
- パスワード入力フィールド
- ログインボタン
- エラーメッセージ表示

### 3.2 ダッシュボード画面
- ヘッダー
  - ボード選択ドロップダウン
  - ログアウトボタン
- メインエリア
  - リスト一覧（横スクロール）
  - 各リスト内にカード一覧（縦スクロール）
  - リスト追加ボタン
- カード詳細モーダル
  - タイトル、内容、日付の編集
  - ラベル追加・削除
  - ファイル添付・削除

---

## 4. データベース設計

### 4.1 テーブル構成

#### users
- id (PRIMARY KEY)
- username (UNIQUE)
- password_hash
- created_at

#### boards
- id (PRIMARY KEY)
- user_id (FOREIGN KEY)
- title
- position
- created_at
- updated_at

#### lists
- id (PRIMARY KEY)
- board_id (FOREIGN KEY)
- title
- position
- created_at
- updated_at

#### cards
- id (PRIMARY KEY)
- list_id (FOREIGN KEY)
- title
- description
- due_date
- position
- created_at
- updated_at

#### labels
- id (PRIMARY KEY)
- board_id (FOREIGN KEY)
- name
- color
- created_at

#### card_labels
- card_id (FOREIGN KEY)
- label_id (FOREIGN KEY)
- PRIMARY KEY (card_id, label_id)

#### attachments
- id (PRIMARY KEY)
- card_id (FOREIGN KEY)
- filename
- r2_key
- file_size
- created_at

---

## 5. 開発・デプロイフロー

### 5.1 ローカル開発
1. SQLiteでローカルDB作成
2. マイグレーションファイル作成
3. テストデータ投入
4. SvelteKit開発サーバーで動作確認

### 5.2 本番デプロイ
1. Cloudflare D1データベース作成
2. マイグレーションをD1に適用
3. R2バケット作成・設定
4. Cloudflare Pagesにデプロイ
5. 環境変数設定（D1, R2接続情報）

### 5.3 移行手順
```
ローカル: SQLite (開発・テスト)
    ↓ マイグレーションファイル
本番: Cloudflare D1 (本番環境)
```

---

## 6. デザイン要件

### 6.1 デザイン方針
- **フラットデザイン**: シンプルで平面的なUI
- **統一感**: 全ページで一貫したデザイン言語
- **カラースキーム**: ページ全体で統一された基本色を使用

### 6.2 アイコン
- **スタイル**: ページの基本色に合わせた単色アイコン
- **統一性**: 同じアイコンセット・スタイルで統一
- **推奨ライブラリ**:
  - Heroicons
  - Lucide Icons
  - または同等のシンプルなアイコンセット
- **使用箇所**: ボタン、ラベル、機能表示など

### 6.3 カラーパレット
- 基本色を1-2色に絞る
- アクセントカラーは基本色から派生
- グレースケールは統一されたトーン

---

## 7. 非機能要件

### 7.1 パフォーマンス
- カード数100件程度までスムーズに動作
- ドラッグ&ドロップの遅延なし

### 7.2 ブラウザ対応
- Chrome最新版
- Firefox最新版
- Safari最新版

### 7.3 レスポンシブ対応
- デスクトップ優先
- タブレット表示対応（オプション）

---

## 8. 実装優先順位

### Phase 1（MVP）
1. 認証機能（ログイン/ログアウト）
2. ボード・リスト・カードのCRUD
3. カード基本情報（タイトル、内容、日付）
4. 基本的なUI

### Phase 2
1. ドラッグ&ドロップ機能
2. 並び替え機能
3. ラベル機能

### Phase 3
1. ファイル添付（R2連携）
2. UI/UX改善
3. 細かい機能調整

---

## 9. 技術的な注意点

### 9.1 ドラッグ&ドロップ
- ライブラリ: `@hello-pangea/dnd` または `svelte-dnd-action`
- position値での順序管理

### 9.2 D1とR2の接続
- Cloudflare Workers環境での`env`オブジェクト利用
- SvelteKitの`platform.env`からアクセス

### 9.3 セキュリティ
- パスワードはbcryptでハッシュ化
- CSRF対策（SvelteKit標準機能）
- R2ファイルへの直接アクセス制限

---

## 10. 今後の拡張可能性（オプション）

- 検索機能
- アーカイブ機能
- カラーテーマ変更
- キーボードショートカット
- カレンダービュー
- 統計・分析機能
